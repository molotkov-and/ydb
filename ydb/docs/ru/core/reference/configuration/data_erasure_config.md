# Секция конфигурации data_erasure_config

Чтобы удалённые данные были физически очищены с диска, {{ ydb-short-name }} предоставляет возможность запустить специализированную процедуру, которая удалит все следы таких данных с диска. Подробную информацию можно найти в статье по [очистке данных](../../security/data-erasure.md). Для настройки процесса очистки данных требуется заполнить секцию `data_erasure_config` и включить флаг `enable_data_erasure` в файле конфигурации.

## Конфигурация очистки данных {#data-erasure-config}

Процесс очистки запускается для всех баз кластера и его можно условно разделить на 2 этапа: очистка на уровне внутренних структур баз данных и очистка в [слое хранения](../../concepts/glossary.md#distributed-storage-implementation).

Включение флага `enable_data_erasure`:

```yaml
feature_flags:
  enable_data_erasure: true
```

Пример секции `data_erasure_config`:

```yaml
data_erasure_config:
  max_rate: 0
  inflight_limit: 10
  timeout_seconds: 15
  data_erasure_interval_seconds: 604800
  blob_storage_controller_request_interval_seconds: 600
  tenant_data_erasure_config:
    max_rate: 0
    inflight_limit: 10
    timeout_seconds: 15
```

Конфигурационные параметры влияют на планирование следующей очистки и на ее интенсивность. Чем выше выставлены значения для параметров `max_rate`, `inflight_limit`, `tenant_data_erasure_config.max_rate` и `tenant_data_erasure_config.inflight_limit` тем будет больше выполнятся операций очистки для баз данных в кластере и для таблеток каждой из баз, что может привести к повышению нагрузки на всю систему. Рекомендуемые параметры приведены в примере.
В конфигурации существует два уровня регулирования интенсивности очистки.
Параметры `data_erasure_config.max_rate` и `data_erasure_config.inflight_limit` управляют скоростью запуска очистки для баз в кластере и количеством одновременно очищаемых баз.
На втором уровне, параметры `tenant_data_erasure_config.max_rate` и `tenant_data_erasure_config.inflight_limit` управляют интенсивностью очистки внутренних структур в конкретной базе. Эти параметры спущены на уровень таблеток базы, так как они управляют сегментами пользовательских данных.

#|
|| Параметр | Описание | Единицы измерения ||
|| `max_rate`
| Скорость, с которой будут запускаться очистки в базах кластера. В момент, когда наступает время очередной очистки, она не запускается во всех базах кластера одновременно, а происходит по очереди, с периодичностью `1 / max_rate` секунд. Если количество запусков достигнет `inflight_limit`, то очистка в следующей базе будет запущена после завершения одной из предыдущих.<br/>Например, если значение `max_rate` равно 2, то это можно интерпретировать как запуск очистки для базы происходит спустя 0.5 секунды после запуска очистки на предыдущей базе.
| Количество запусков очистки в базах в секунду
    ||
|| `inflight_limit`
| Максимальное число баз данных, для которых одновременно выполняется очистка
| Количество баз данных
    ||
|| `timeout_seconds`
| Время в секундах, за которое отдельная база данных должна выполнить очистку. Если по каким-то причинам не удалось завершить очистку за отведенное время, процесс очистки для этой базы данных повторится.
| Секунды
    ||
|| `data_erasure_interval_seconds`
| Интервал времени, через который должна запуститься следующая очистка в базах кластера. Каждый цикл очистки будет запущен спустя `data_erasure_interval_seconds` секунд после начала предыдущего, если к этому времени предыдущий запуск успеет завершиться. Если процесс очистки требует больше времени чем значение `data_erasure_interval_seconds`, то следующий запуск очистки баз данных будет произведен сразу же после завершения предыдущего.
При первом старте кластера очистка запустится спустя `data_erasure_interval_seconds` секунд. Следующие циклы очистки будут запускаться в зависимости от завершения первой очистки.

Если значение параметра будет выставлено в `0`, то новый цикл очистки не запустится.
| Секунды
    ||
|| `blob_storage_controller_request_interval_seconds`
| Интервал времени, через который выполняются запросы к слою хранения для получения прогресса очистки. Очистка в слое хранения запускается сразу после того, как завершилась очистка внутренних структур всех баз данных кластера.
| Секунды
    ||
|| `tenant_data_erasure_config.max_rate`
| Скорость, с которой будут запускаться очистки в таблетках одной базы данных. Очистка не запускается сразу во всех таблетках,а происходит с периодичностью `1/ tenant_data_erasure_config.max_rate` секунд. Если количество запусков достигнет `tenant_data_erasure_config.inflight_limit`, то очистка в следующей таблетке запустится после завершения очистки в одной из уже запущенных.<br/>Например, если значение `tenant_data_erasure_config.max_rate` равно 50, то это означает, что запуск очистки для таблеток происходит спустя 1/50 долю секунды после запуска предыдущей таблетки.
| Количество таблеток в секунду
    ||
|| `tenant_data_erasure_config.inflight_limit`
| Максимальное число таблеток, для которых одновременно выполняется очистка.
| Количество таблеток
    ||
|| `tenant_data_erasure_config.timeout_seconds`
| Время в секундах, за которое таблетка должна выполнить очистку данных. Если по каким-то причинам не удалось завершить очистку за отведенное время, процесс очистки для этой таблетки повторится.
| Секунды
    ||
|#

### Остановка процесса очистки

Для остановки запущенного процесса очистки нужно перевести флаг `enable_data_erasure` в значение `false`. Флаг применяется "на лету", никакие вычислительные узлы перезагружать не требуется.
